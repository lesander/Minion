/*! Minion v0.1.0.pre | (c) 2014 The PTR Team  | popcorntimeremote.com */
function popcorntimeConnect(a,b,c,d){var e={id:Math.floor(1e5*Math.random()),jsonrpc:"2.0",caller:"PTR-Minion-"+App.Settings.version,callerLocation:window.location.href,method:"ping",params:[]};return console.debug("[DEBUG] Connecting to "+c+"@"+a+":"+b+" with password: "+d),App.Settings.Debug.enabled&&App.Settings.Debug.doConnectDump&&(console.debug("[EXTRA-DEBUG] Request "+e.id+" dump:"),console.debug(e)),$.ajax({type:"POST",url:"http://"+a+":"+b,data:JSON.stringify(e),async:!1,beforeSend:function(a){a.setRequestHeader("Authorization",window.btoa(c+":"+d))},success:function(a){"undefined"==typeof a.error?(console.info("[INFO] Connection established."),App.Client.version=a.result.popcornVersion,console.info("[INFO] PT client has version '"+App.Client.version+"'."),isClientSupported(App.Client.version),App.Client.connected=!0):(console.error("[ERROR] Invalid login credentials."),alert("Invalid login credentials provided."),$(".btn-settings-close").addClass("hidden"),$(".settings-ui").addClass("hidden"),$(".btn-reload").addClass("hidden"),$(".btn-reset").addClass("hidden"),showSection("settings"),App.Client.connected=!1)},error:function(){console.error("[ERROR] Couldn't connect to given address."),alert("Could not connect to "+a+":"+b+". Please check your settings and try again."),$(".btn-settings-close").addClass("hidden"),$(".settings-ui").addClass("hidden"),$(".btn-reload").addClass("hidden"),$(".btn-reset").addClass("hidden"),showSection("settings"),App.Client.connected=!1}}),App.Client.connected?!0:!1}function popcorntimeAPI(a,b){if(!App.Client.connected)return console.warn("[WARNING] Can't call popcorntime API: not connected."),!1;"undefined"==typeof b&&(b=[]);var c={id:Math.floor(1e5*Math.random()),jsonrpc:"2.0",caller:"PTR-Minion-"+App.Settings.version,callerLocation:window.location.href,method:a,params:b};return $.ajax({type:"POST",url:"http://"+App.Settings.Connection.ip+":"+App.Settings.Connection.port,data:JSON.stringify(c),async:!1,beforeSend:function(a){a.setRequestHeader("Authorization",window.btoa(App.Settings.Connection.username+":"+App.Settings.Connection.password))},success:function(a){responseHandler(c,a)},error:function(a,b){if(console.error("[ERROR] Request id "+c.id+" was not successful."),App.errorCount>10&&App.exit!==!0)throw App.exit=!0,showSection("lostconnection"),App.Settings.Debug.doInterval=!1,new Error("Lost connection to Popcorn Time client. Stopping interval.");App.errorCount++,console.log(b),console.log(a)}}),null}function responseHandler(a,b){switch(a.method){case"getviewstack":$("#menu").removeClass("hidden"),viewstackHandler(b);break;case"getcurrenttab":b.result.tab!=App.Tab.current&&setTab(b.result.tab),App.Tab.old=App.Tab.current,App.Tab.current=b.result.tab;break;case"getplaying":App.Player.isPlaying=b.result.playing,0!=b.result.quality?($(".streamer-title").text(b.result.title+" - "+b.result.quality),App.Player.isTrailer=!1):App.Player.isTrailer=!0;break;case"getselection":if(App.Subtitles={},"player"===App.Client.view);else if("movie-detail"===App.Client.view)"images/posterholder.png"===b.result.image&&(b.result.image="assets/img/posterholder.png"),$(".movie-detail-poster").attr("src",b.result.image),"undefined"!=typeof b.result.backdrop&&$(".movie-detail-container").attr("style","background-image: url("+b.result.backdrop+");"),$(".movie-detail-title").text(""+b.result.title),$(".movie-detail-year").text(""+b.result.year),$(".movie-detail-rating").text(""+b.result.rating+"/10"),$(".movie-detail-synopsis").html("<p>"+b.result.synopsis+"</p>"),$(".expand").removeClass("hidden"),$(".movie-detail").addClass("minimised"),$(".btn-movie-detail-favourite").removeClass("added"),$(".btn-movie-detail-favourite").find("i").removeClass("red"),$(".btn-movie-detail-favourite span").text("Bookmark"),$(".btn-movie-detail-watched").removeClass("watched-icon"),$(".btn-movie-detail-watched").find("i").removeClass("none watched-icon"),$(".btn-movie-detail-watched span").text("Mark watched"),$(".movie-detail-genre").text(""+b.result.genre),$(".movie-detail-runtime").text(""+b.result.runtime+" min"),$(".movie-detail-imdb").html('<a href="http://imdb.com/title/'+b.result.imdb_id+'/" target="_blank"><img src="assets/img/imdb.png"></a>'),b.result.bookmarked&&($(".btn-movie-detail-favourite").find("i").toggleClass("none red"),$(".btn-movie-detail-favourite").addClass("added"),$(".btn-movie-detail-favourite span").text("Bookmarked")),b.result.watched&&($(".btn-movie-detail-watched").find("i").toggleClass("none watched-icon"),$(".btn-movie-detail-watched").addClass("watched-icon"),$(".btn-movie-detail-watched span").text("Watched")),App.Subtitles=b.result.subtitle,$(".btn-movie-detail-quality").text(b.result.quality);else if("shows-container-contain"===App.Client.view){$(".show-detail-title").text(b.result.title),$(".show-detail-year").text(b.result.year+" - "+b.result.status),$(".show-detail-seasons").text(b.result.num_seasons+" Seasons"),$(".show-detail-runtime").text(b.result.runtime+" min"),$(".show-detail-synopsis").html("<p>"+b.result.synopsis+"</p>"),$(".show-detail-genre").text(b.result.genres[0]),$(".show-detail-rating").text([b.result.rating.percentage/10]+"/10"),$(".show-detail-poster").attr("src",b.result.images.poster),$(".show-detail-imdb").html('<a href="http://imdb.com/title/'+b.result.imdb_id+'/" target="_blank"><img src="assets/img/imdb.png"></a>'),$(".show-detail-container").attr("style","background-image: url("+b.result.images.fanart+");"),b.result.bookmarked&&($(".btn-show-detail-favourite").find("i").toggleClass("none red"),$(".btn-show-detail-favourite").addClass("added"),$(".btn-show-detail-favourite span").text("Bookmarked")),$(".episode-detail-title").text(b.result.selectedEpisode.title),$(".episode-detail-season").text("Season "+b.result.selectedEpisode.season+", "),$(".episode-detail-episode").text("Episode "+b.result.selectedEpisode.episode),$(".episode-detail-synopsis").text(b.result.selectedEpisode.overview),"undefined"!=typeof b.result.selectedEpisode.torrents["720p"]?$(".btn-episode-detail-quality").text("720p"):$(".btn-episode-detail-quality").text("480p"),1==b.result.selectedEpisode.watched.watched&&($(".btn-episode-detail-watched").find("i").removeClass("grey"),$(".btn-episode-detail-watched").find("i").addClass("white"),$(".btn-episode-detail-watched span").text("Watched")),$(".episodes-list").children().remove(),$(".episodes-list").append('<option value="">Select Episode</option>');for(var c=1;100>=c;c++)$.each(b.result.episodes,function(a,b){b.season===c&&$(".episodes-list").append('<option value="'+b.season+"-"+b.episode+'"> S'+b.season+" E"+b.episode+" "+b.title+"</option>")})}else console.warn("[WARNING] Unknown view '"+App.Client.view+"' to set media info for.");break;case"getcurrentlist":if("undefined"==typeof b.result||"undefined"==typeof b.result.page){console.error("[ERROR] Client gave us an empty list!"),setTimeout(function(){"main-browser"===App.Client.view&&popcorntimeAPI("getcurrentlist")},5e3);break}$("#main-browser .list").children().remove(),"movie"===b.result.type?$.each(b.result.list,function(a,c){"undefined"==typeof c.image?c.image=c.images.poster:"images/posterholder.png"===c.image&&(c.image="assets/img/posterholder.png"),"undefined"==typeof c.year&&(c.year=""),c.rating="undefined"==typeof c.rating?"":c.rating+"/10",b.result.list[a].watched?"fade"==App.Settings.UI.watchedItems||null==App.Settings.UI.watchedItems||""==App.Settings.UI.watchedItems||"undefined"==App.Settings.UI.watchedItems?$("#main-browser .list").append('<li class="item watched" data-index="'+a+'"><div class="item-cover" style="background-image: url('+c.image+');"><div class="item-overlay"></div></div><div class="item-info"><div class="item-title">'+c.title+'</div><span class="item-year pull-left">'+c.year+'</span><span class="item-rating pull-right">'+c.rating+"</span></div></li>"):"show"==App.Settings.UI.watchedItems&&$("#main-browser .list").append('<li class="item" data-index="'+a+'"><div class="item-cover" style="background-image: url('+c.image+');"><div class="item-overlay"></div></div><div class="item-info"><div class="item-title">'+c.title+'</div><span class="item-year pull-left">'+c.year+'</span><span class="item-rating pull-right">'+c.rating+"</span></div></li>"):$("#main-browser .list").append('<li class="item" data-index="'+a+'"><div class="item-cover" style="background-image: url('+c.image+');"><div class="item-overlay"></div></div><div class="item-info"><div class="item-title">'+c.title+'</div><span class="item-year pull-left">'+c.year+'</span><span class="item-rating pull-right">'+c.rating+"</span></div></li>")}):"show"===b.result.type?$.each(b.result.list,function(a,b){"images/posterholder.png"===b.images.poster&&(b.images.poster="assets/img/posterholder.png"),$("#main-browser .list").append('<li class="item" data-index="'+a+'"><div class="item-cover" style="background-image: url('+b.images.poster+');"><div class="item-overlay"></div></div><div class="item-info"><div class="item-title">'+b.title+'</div><span class="item-year pull-left">'+b.year+'</span><!--//<span class="item-rating pull-right">'+b.rating+"/10</span>//--></div></li>")}):"anime"===b.result.type||"bookmarkedmovie"===b.result.type&&$.each(b.result.list,function(a,c){"object"==typeof c.rating&&(c.rating=[c.rating.percentage/10]),b.result.list[a].watched?"fade"==App.Settings.UI.watchedItems||""==App.Settings.UI.watchedItems||null==App.Settings.UI.watchedItems||"undefined"==App.Settings.UI.watchedItems?$("#main-browser .list").append('<li class="item watched" data-index="'+a+'"><div class="item-cover" style="background-image: url('+c.image+');"><div class="item-overlay"></div></div><div class="item-info"><div class="item-title">'+c.title+'</div><span class="item-year pull-left">'+c.year+'</span><span class="item-rating pull-right">'+c.rating+"/10</span></div></li>"):"show"==App.Settings.UI.watchedItems&&$("#main-browser .list").append('<li class="item" data-index="'+a+'"><div class="item-cover" style="background-image: url('+c.image+');"><div class="item-overlay"></div></div><div class="item-info"><div class="item-title">'+c.title+'</div><span class="item-year pull-left">'+c.year+'</span><span class="item-rating pull-right">'+c.rating+"/10</span></div></li>"):$("#main-browser .list").append('<li class="item" data-index="'+a+'"><div class="item-cover" style="background-image: url('+c.image+');"><div class="item-overlay"></div></div><div class="item-info"><div class="item-title">'+c.title+'</div><span class="item-year pull-left">'+c.year+'</span><span class="item-rating pull-right">'+c.rating+"/10</span></div></li>")}),$("#main-browser .list").append('<li class="item"><a class="btn-more btn btn-primary btn-minion">Load More..</a></li>'),App.Client.page=b.result.page;break;case"getstreamurl":("true"==App.Player.playHere||null==App.Player.playHere)&&($("#streamer-video").attr("src",b.result.streamUrl),$("#streamer-source").attr("src",b.result.streamUrl),void 0!=App.Subtitles[App.Player.selectedSubtitles]&&(console.debug("[DEBUG] Selected subtitles: "+App.Subtitles[App.Player.selectedSubtitles]),$("#streamer-track").attr("srclang",App.Player.selectedSubtitles),App.Settings.ZipExtractor.url,$("#streamer-track").attr("src",App.Settings.ZipExtractor.url+"?key="+App.Settings.ZipExtractor.password+"&url="+App.Subtitles[App.Player.selectedSubtitles])),$("#streamer-link").attr("href","streamer.html?extractor="+App.Settings.ZipExtractor.url+"&key="+App.Settings.ZipExtractor.password+"&lang="+App.Player.selectedSubtitles+"&src="+b.result.streamUrl+"&subs="+App.Subtitles[App.Player.selectedSubtitles]),$("#streamer-link").on("click",function(){$("#streamer-video").get(0).pause()}));break;case"toggleplaying":$(".btn-player-pause").toggleClass("fa-play fa-pause");break;case"volume":App.Player.currentVolume=b.result.volume;break;case"getsubtitles":"movie-detail"===App.Client.view&&App.Player.isTrailer!==!1?($(".movie-detail-select-subtitles").children().remove(),$(".movie-detail-select-subtitles").append('<option value="none">Select subtitles</option>'),$.each(b.result.subtitles,function(a,b){$(".movie-detail-select-subtitles").append('<option value="'+b+'">'+App.SubtitleLanguages[b]+"</option>")})):"player"===App.Client.view&&(console.debug(b),"undefined"!=typeof b.result.episode);break;case"getplayers":if("undefined"==typeof b.result||"undefined"==typeof b.result.players?(console.error("[ERROR] Got empty list of players."),noPlayers=!0):noPlayers=!1,"movie-detail"===App.Client.view){if($(".select-players").children().remove(),$(".select-players").append('<li role="presentation" class="dropdown-header">Select a device to stream to</li>'),$(".select-players").append('<li role="presentation" data-player=""><a role="menuitem" tabindex="-1" class="change-player" href="#movdet-actions">This device <img class="player-icon" src="assets/img/player-external.png"></a></li>'),noPlayers)break;$.each(b.result.players,function(a,b){$(".select-players").append('<li role="presentation" data-player="'+b.id+'"><a role="menuitem" tabindex="-1" class="change-player" href="#movdet-actions">'+b.name+' <img class="player-icon" src="assets/img/player-'+b.id+'.png"></a></li>')})}else if("shows-container-contain"===App.Client.view){if($(".select-players-episode").children().remove(),$(".select-players-episode").append('<li role="presentation" class="dropdown-header">Select a device to stream to</li>'),$(".select-players-episode").append('<li role="presentation" data-player=""><a role="menuitem" tabindex="-1" class="change-player-episode" href="#episode-actions">This device <img class="player-icon" src="assets/img/player-external.png"></a></li>'),noPlayers)break;$.each(b.result.players,function(a,b){$(".select-players-episode").append('<li role="presentation" data-player="'+b.id+'"><a role="menuitem" tabindex="-1" class="change-player-episode" href="#episode-actions">'+b.name+' <img class="player-icon" src="assets/img/player-'+b.id+'.png"></a></li>')})}break;case"getgenres":break;case"getsorters":break;case"filtersearch":case"clearsearch":popcorntimeAPI("getcurrentlist");break;case"togglefavourite":if("movie-detail"===App.Client.view){var d=$(".btn-movie-detail-favourite");$(d).find("i").toggleClass("none red"),$(d).hasClass("added")?($(d).removeClass("added"),$(".btn-movie-detail-favourite span").text("Bookmark")):($(d).addClass("added"),$(".btn-movie-detail-favourite span").text("Bookmarked"))}else if("shows-container-contain"===App.Client.view){var d=$(".btn-show-detail-favourite");$(d).find("i").toggleClass("non red"),$(d).hasClass("added")?($(d).removeClass("added"),$(".btn-show-detail-favourite span").text("Bookmark")):($(d).addClass("added"),$(".btn-show-detail-favourite span").text("Bookmarked"))}break;case"togglewatched":if("movie-detail"===App.Client.view){var d=$(".btn-movie-detail-watched");$(d).find("i").toggleClass("none watched-icon"),$(d).hasClass("watched-icon")?($(d).removeClass("watched-icon"),$(".btn-movie-detail-watched span").text("Mark watched")):($(d).addClass("added"),$(".btn-movie-detail-watched span").text("Watched"))}else if("shows-container-contain"===App.Client.view){var d=$(".btn-episode-detail-watched");$(d).find("i").toggleClass("grey white"),$(d).find("i").hasClass("grey")?$(".btn-episode-detail-watched span").text("Mark watched"):$(".btn-episode-detail-watched span").text("Watched")}break;case"setsubtitle":"movie-detail"===App.Client.view&&$(".movie-detail-select-subtitles").val(a.params);break;case"setplayer":if("movie-detail"===App.Client.view){$("[data-player]").removeClass("player-selected"),$('[data-player="'+a.params+'"]').addClass("player-selected");var e=$('[data-player="'+a.params+'"] > a > img').attr("src");$(".btn-players-caret > .caret-icon").removeClass("caret"),$(".btn-players-caret > .caret-icon").html('<img class="player-icon-main" src="'+e+'"> <i class="caret"></i>')}else if("shows-container-contain"===App.Client.view){$("[data-player]").removeClass("player-selected-episode"),$('[data-player="'+a.params+'"]').addClass("player-selected-episode");var e=$('[data-player="'+a.params+'"] > a > img').attr("src");$(".btn-players-episode-caret > .caret-icon").removeClass("caret"),$(".btn-players-episode-caret > .caret-icon").html('<img class="player-icon-main" src="'+e+'"> <i class="caret"></i>')}break;case"togglequality":if("movie-detail"===App.Client.view){var d=$(".btn-movie-detail-quality");"1080p"===d.text()?d.text("720p"):"720p"===d.text()&&d.text("1080p")}else if("shows-container-contain"===App.Client.view){var d=$(".btn-episode-detail-quality");"720p"===d.text()?d.text("480p"):"480p"===d.text()&&d.text("720p")}break;case"selectepisode":popcorntimeAPI("getselection");break;case"up":case"down":case"left":case"right":case"enter":case"movieslist":case"showslist":case"animelist":case"showwatchlist":case"showfavourites":case"showabout":case"showsettings":case"previousseason":case"nextseason":case"back":case"seek":case"filtergenre":case"filtersorter":case"filtersearch":case"ping":case"watchtrailer":case"setselection":console.info("[INFO] Method '"+a.method+"' has no handler.");break;default:console.warn("[WARNING] Unknown method '"+a.method+"'.")}}function viewstackHandler(a){if(currentview=a.result.viewstack[a.result.viewstack.length-1],App.Client.view!==currentview&&$("#settings").is(":visible")===!1){if(console.debug("[DEBUG] View changed, new view: '"+currentview+"'."),$("#main-browser .list").children().remove(),App.Settings.UI.forceView===!0&&""!==App.Settings.UI.startscreen){switch(App.Settings.UI.startscreen){case"shows":popcorntimeAPI("showslist");break;case"movies":popcorntimeAPI("movieslist");break;case"":break;case"anime":popcorntimeAPI("animelist");break;case"watchlist":popcorntimeAPI("showwatchlist");break;case"favourites":popcorntimeAPI("showfavourites")}App.Settings.UI.forceView=!1}switch(currentview){case"main-browser":showSection("main-browser"),popcorntimeAPI("getcurrentlist"),$(".list").on("click",".btn-more",function(){$(this).hide(),popcorntimeAPI("getcurrentlist",[App.Client.page+1])});break;case"shows-container-contain":showSection("shows-container"),App.Client.view=currentview,popcorntimeAPI("getselection"),popcorntimeAPI("getplayers");break;case"movie-detail":showSection("movie-detail"),App.Client.view=currentview,popcorntimeAPI("getplayers"),popcorntimeAPI("getsubtitles"),popcorntimeAPI("getselection");break;case"player":popcorntimeAPI("getplaying"),popcorntimeAPI("getsubtitles"),App.Player.playHere=sessionStorage.getItem("playHere"),console.debug("[DEBUG] App.Player.playHere = "+App.Player.playHere+"."),popcorntimeAPI("getstreamurl"),"true"==App.Player.playHere||null==App.Player.playHere&&0==App.Player.isTrailer?(App.Player.isPlaying&&popcorntimeAPI("toggleplaying"),showSection("streamer")):(showSection("player"),0==App.Player.isPlaying&&($(".btn-player-pause").removeClass("fa fa-pause"),$(".btn-player-pause").addClass("fa fa-play")));break;case"settings-container-contain":showSection("default");break;case"about":showSection("about");break;case"init-container":showSection("loading"),App.Settings.UI.forceView=!0;break;case"app-overlay":showSection("downloading");break;case"keyboard":showSection("default")}App.Client.view=currentview}else"main-browser"===currentview&&("movies"===App.Tab.current||"shows"===App.Tab.current||"anime"===App.Tab.current?$(".search").removeClass("hidden"):$(".search").addClass("hidden"),("movies"===App.Tab.current||"shows"===App.Tab.current||"anime"===App.Tab.current||"Watchlist"===App.Tab.current||"Favorites"===App.Tab.current)&&App.Tab.current!==App.Tab.old&&($("#main-browser .list").children().remove(),popcorntimeAPI("getcurrentlist"),popcorntimeAPI("getgenres"),popcorntimeAPI("getsorters")))}function setSettings(a,b,c,d,e,f,g){return localStorage.setItem(App.Settings.prefix+"ip",a),localStorage.setItem(App.Settings.prefix+"port",b),localStorage.setItem(App.Settings.prefix+"username",c),localStorage.setItem(App.Settings.prefix+"password",d),localStorage.setItem(App.Settings.prefix+"ui_language",e),localStorage.setItem(App.Settings.prefix+"ui_startscreen",f),localStorage.setItem(App.Settings.prefix+"ui_watcheditems",g),console.debug("[DEBUG] Settings were set."),!0}function loadSettings(){App.Settings.Connection.ip=localStorage.getItem(App.Settings.prefix+"ip"),App.Settings.Connection.port=localStorage.getItem(App.Settings.prefix+"port"),App.Settings.Connection.username=localStorage.getItem(App.Settings.prefix+"username"),App.Settings.Connection.password=localStorage.getItem(App.Settings.prefix+"password"),App.Settings.UI.language=localStorage.getItem(App.Settings.prefix+"ui_language"),App.Settings.UI.startscreen=localStorage.getItem(App.Settings.prefix+"ui_startscreen"),App.Settings.UI.watchedItems=localStorage.getItem(App.Settings.prefix+"ui_watcheditems"),$(".settings-address").val(App.Settings.Connection.ip),$(".settings-port").val(App.Settings.Connection.port),$(".settings-username").val(App.Settings.Connection.username),$(".settings-password").val(App.Settings.Connection.password),$(".settings-language").val(App.Settings.UI.language),$(".settings-startscreen").val(App.Settings.UI.startscreen),$(".settings-watcheditems").val(App.Settings.UI.watchedItems),console.debug("[DEBUG] Settings were reloaded.")}function showSection(a){return""===a?(console.warn("[WARNING] Empty argument given for showSection."),!1):(console.debug("[DEBUG] Switching to section '"+a+"'."),$(".section").addClass("hidden"),$("#"+a).hide(),$("#"+a).removeClass("hidden"),$("#"+a).fadeIn("slow"),!0)}function hasRequiredStorage(){return localStorageExists(App.Settings.prefix+"ip")&&localStorageExists(App.Settings.prefix+"port")&&localStorageExists(App.Settings.prefix+"username")&&localStorageExists(App.Settings.prefix+"password")?!0:localStorageExists("ip")&&localStorageExists("port")&&localStorageExists("username")&&localStorageExists("password")?(localStorage.setItem(App.Settings.prefix+"ip",localStorage.getItem("ip")),localStorage.setItem(App.Settings.prefix+"port",localStorage.getItem("port")),localStorage.setItem(App.Settings.prefix+"username",localStorage.getItem("username")),localStorage.setItem(App.Settings.prefix+"password",localStorage.getItem("password")),localStorage.setItem(App.Settings.prefix+"ui_language",localStorage.getItem("language")),localStorage.setItem(App.Settings.prefix+"ui_startscreen",localStorage.getItem("startscreen")),localStorage.setItem(App.Settings.prefix+"ui_watcheditems",localStorage.getItem("watcheditems")),localStorage.removeItem("ip"),localStorage.removeItem("port"),localStorage.removeItem("username"),localStorage.removeItem("password"),localStorage.removeItem("language"),localStorage.removeItem("startscreen"),localStorage.removeItem("watcheditems"),alert("Updated local storage to new format."),location.reload(),!1):!1}function registerListeners(){$(".btn-movies").on("click",function(){popcorntimeAPI("movieslist")}),$(".btn-shows").on("click",function(){popcorntimeAPI("showslist")}),$(".btn-anime").on("click",function(){popcorntimeAPI("animelist")}),$(".btn-inbox").on("click",function(){popcorntimeAPI("showwatchlist")}),$(".btn-favourites").on("click",function(){popcorntimeAPI("showfavourites")}),$(".search-term").on("keydown",function(a){""==a.value?$(".search-remove").addClass("hidden"):$(".search-remove").removeClass("hidden"),(13==a.keyCode||10==a.keyCode)&&(a.preventDefault(),popcorntimeAPI("filtersearch",[this.value]))}),$(".search-enter").on("click",function(){popcorntimeAPI("filtersearch",[$(".search-term").val()])}),$(".search-remove").on("click",function(){popcorntimeAPI("clearsearch"),$(".search-term").val(""),$(".search-remove").addClass("hidden")}),$(".btn-settings").on("click",function(){showSection("settings")}),$(".btn-settings-close").on("click",function(){showSection(App.Client.view)}),$(".list").on("click",".item",function(){popcorntimeAPI("setselection",[parseInt($(this).attr("data-index"))]),popcorntimeAPI("enter")}),$(".expand").on("click",function(){$(".movie-detail-synopsis").removeClass("minimised"),$(this).addClass("hidden")}),$(".btn-movie-detail-favourite").on("click",function(){popcorntimeAPI("togglefavourite")}),$(".btn-movie-detail-watched").on("click",function(){popcorntimeAPI("togglewatched")}),$(".movie-detail-select-subtitles").on("change",function(){popcorntimeAPI("setsubtitle",[this.value]),$(".movie-detail-select-subtitles > option > span").remove(),$('option[value="'+this.value+'"]').prepend("<span>Selected: </span>"),App.Player.selectedSubtitles=this.value}),$(".select-players").on("click",".change-player",function(){""===$(this).parent().attr("data-player")?(App.Player.playHere=!0,sessionStorage.setItem("playHere","true")):(App.Player.playHere=!1,sessionStorage.setItem("playHere","false")),popcorntimeAPI("setplayer",[$(this).parent().attr("data-player")])}),$(".btn-trailer").on("click",function(){popcorntimeAPI("watchtrailer")}),$(".btn-movie-detail-quality").on("click",function(){popcorntimeAPI("togglequality")}),$(".btn-watch").on("click",function(){popcorntimeAPI("enter")}),$(".btn-watch-episode").on("click",function(){popcorntimeAPI("enter")}),$(".episodes-list").on("change",function(){var a=$(this).val(),b=a.split("-");popcorntimeAPI("selectepisode",[b[0],b[1]])}),$(".btn-show-detail-favourite").on("click",function(){popcorntimeAPI("togglefavourite")}),$(".btn-episode-detail-quality").on("click",function(){popcorntimeAPI("togglequality")}),$(".select-players-episode").on("click",".change-player-episode",function(){""===$(this).parent().attr("data-player")?(App.Player.playHere=!0,sessionStorage.setItem("playHere","true")):(App.Player.playHere=!1,sessionStorage.setItem("playHere","false")),popcorntimeAPI("setplayer",[$(this).parent().attr("data-player")])}),$(".btn-episode-detail-watched").on("click",function(){popcorntimeAPI("togglewatched")}),$(".btn-back").on("click",function(){popcorntimeAPI("back")}),$(".btn-stop-stream").on("click",function(){$("#streamer-video").get(0).pause()}),$(".btn-player-pause").on("click",function(){popcorntimeAPI("toggleplaying")}),$(".btn-player-up").on("click",function(){popcorntimeAPI("volume",[App.Player.currentVolume+.1])}),$(".btn-player-down").on("click",function(){popcorntimeAPI("volume",[App.Player.currentVolume-.1])}),$(".btn-player-left").on("click",function(){popcorntimeAPI("seek",[-10])}),$(".btn-player-right").on("click",function(){popcorntimeAPI("seek",[10])}),$(".btn-save").on("click",function(){setSettings($(".settings-address").val(),$(".settings-port").val(),$(".settings-username").val(),$(".settings-password").val(),$(".settings-language").val(),$(".settings-startscreen").val(),$(".settings-watcheditems").val()),loadSettings(),alert("Settings saved!"),location.reload()}),$(".btn-reset").on("click",function(){window.confirm("Are you sure you want to reset the App's settings?")&&(console.info("[INFO] Resetting localStorage.."),localStorage.clear(),location.reload())})}function setTab(a){return $(".btn-movies").removeClass("active"),$(".btn-shows").removeClass("active"),$(".btn-anime").removeClass("active"),$(".btn-favourites-icon").removeClass("red"),$(".btn-inbox-icon").removeClass("icon-active"),"movies"===a||"shows"===a||"anime"===a||"Favorites"===a||"Watchlist"===a?("Favorites"===a?$(".btn-favourites-icon").addClass("red"):"Watchlist"===a?$(".btn-inbox-icon").addClass("icon-active"):$(".btn-"+a).addClass("active"),!0):!1}function localStorageExists(a){return null===a?(console.warn("[WARNING] localStorageExists got empty 'key' parameter."),!1):null!==localStorage.getItem(a)?!0:!1}function isClientSupported(a){return found=null,$.each(App.SupportedVersions,function(b,c){c===a&&(found=!0)}),found===!0?(console.info("[INFO] Client version is supported."),!0):(console.warn("[WARNING] Client version is not supported."),alert("Your Popcorn Time client version '"+a+"' is not supported. Please update your client. Minion might not work correctly on outdated versions."),!1)}if("undefined"==typeof jQuery)throw new Error("Minion.js requires jQuery.");var App={errorCount:0,exit:!1,Settings:{name:"Minion",version:"0.1.0.pre",prefix:"Minion_LS1_",interval:1e3,ZipExtractor:{url:"http://178.62.212.184/zip.php",username:"",password:"574380257039257432968"},Debug:{enabled:!0,extraDebug:!1,doInterval:!0,doConnectDump:!1},Connection:{ip:"",port:"",username:"",password:""},UI:{language:"",startscreen:"",watchedItems:"",forceView:!1}},Client:{version:"",connected:!1,view:"",page:1},Player:{playHere:!0,selectedSubtitles:"",currentVolume:0,isTrailer:null,isPlaying:null},Tab:{current:"",old:""},SupportedVersions:{0:"0.3.5-3",1:"0.3.5",2:"0.4.0"},SubtitleLanguages:{},Subtitles:{}};$("#default").removeClass("hidden"),$(".version").text("Version "+App.Settings.version),$.getJSON("assets/js/langcodes.json",function(a){App.SubtitleLanguages=a}),$(document).ready(function(){console.log("  __  __ _       _             \n |  \\/  (_)     (_)            \n | \\  / |_ _ __  _  ___  _ __  \n | |\\/| | | '_ \\| |/ _ \\| '_ \\ \n | |  | | | | | | | (_) | | | |\n |_|  |_|_|_| |_|_|\\___/|_| |_|\n                               "),console.log(" Minion version "+App.Settings.version+"."),console.log(" Developed by the PTR Team."),console.log(" Copyright (c) 2014, the PTR Team."),console.log(" Released under the GNU GPL V3 License."),console.log(" http://git.io/minion"),console.log(""),console.info("[INFO] Document is ready, starting Minion session."),console.info("[INFO] Minion version "+App.Settings.version+"."),$(".nav-title").text("Minion v"+App.Settings.version),App.Settings.Debug.enabled&&(console.info("[INFO] Extra debugging is enabled. Brace yourself for tons of debug messages!"),console.log("[INFO] Debugging messages can be altered during the session by changing settings in the Object 'App.Settings.Debug'.")),hasRequiredStorage()?(loadSettings(),registerListeners(),popcorntimeConnect(App.Settings.Connection.ip,App.Settings.Connection.port,App.Settings.Connection.username,App.Settings.Connection.password),App.Client.connected&&setInterval(function(){App.Settings.Debug.doInterval&&(popcorntimeAPI("getviewstack"),popcorntimeAPI("getcurrenttab"))},App.Settings.interval)):(console.info("[INFO] Could not find all required localStorage."),console.info("[INFO] Assuming that this is the first session, showing welcome section."),showSection("settings"),$(".welcome").removeClass("hidden"),$(".settings-ui").addClass("hidden"),$(".btn-reload").addClass("hidden"),$(".btn-reset").addClass("hidden"),$(".btn-settings-close").addClass("hidden"),$(".btn-save").on("click",function(){var a=$(".settings-address").val(),b=$(".settings-port").val(),c=$(".settings-username").val(),d=$(".settings-password").val();popcorntimeConnect(a,b,c,d),App.Client.connected&&(setSettings(a,b,c,d),loadSettings(),alert("Connected to Popcorn Time client!"),location.reload())}))});